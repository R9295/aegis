<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link href="{{url_for('static', filename='sign_up.css')}}" type="text/css" rel="stylesheet">
    <link href="{{url_for('static', filename='common.css')}}" type="text/css" rel="stylesheet">
  </head>
  <body>
    <h1 align="center" class="font">Sign Up</h1>

<div align="center">
  <div class="form-group col-lg-4">
    <label for="email">Email address</label>
    <input type="email" class="form-control" name="email" id="email" aria-describedby="emailHelp" placeholder="Enter email">
  </div>
  <br>
  <div class="form-group col-lg-4">
    <label for="password">Password</label>
    <input type="password" class="form-control" name="password" id="password" placeholder="Password">
  </div>
  <br>
  <div class="form-group col-lg-4">
    <label for="password_two">Password Again</label>
    <input type="password" class="form-control" id="password_two" placeholder="Password" onchange="verify_match()">
  </div>
  <br>
  <div class="form-group">
  <label for="image_one">Image One</label>
  <input type="file" name="image_one" id="image_one">
  </div>
  <br>
  <div class="form-group">
  <label for="image_two">Image Two</label>
  <input type="file" name="image_two" id="image_two">
</div>
<br>
<div class="form-group">
<label class="mr-sm-2" for="acc_type">Account Type</label>
 <select class="custom-select mb-2 mr-sm-2 mb-sm-0" id="acc_type" name="account_type">
   <option selected>Standard</option>
   <option value="standard_plus">Standard+</option>
   <option value="premium">Premium</option>
 </select>
 </div>
<br>
  <button type="submit" class="btn btn-primary" onclick="post()">Submit</button>
</div>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <script src="{{url_for('static',filename='cryptostego.min.js')}}"></script>
    <!-- import jsencrypt for RSA stuff and libsodium wrappers for Salsa20 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/2.3.1/jsencrypt.min.js"></script>
    <script src="{{url_for('static', filename='nacl_factory.js')}}"></script>


    <script>
    $("#private_key").hide()
        
    function verify_match(){
      console.log('asd')
    }

    function post(){
    //gather data
    post_data ={};
    post_data['email'] = $("#email").val()
    post_data['password'] = $("#password").val()
    post_data['account_type'] = $("#acc_type").val()
   

    key = {};
    key['need'] = 'True'


    //get a key
        $.ajax({
        type: "POST",
        url: "/get_key",
        contentType: 'application/json',
        data: JSON.stringify(key),
        dataType: 'json',
        success: function success(data){
          //set the keys
          var key = data.key
          var key_hash = data.key_hash

        
          //post the hash
          post_data['key_hash'] = data.key_hash

      //function to write b64 encoded key to image and auto download them.
    function writeIMG(img_number){
    function writefunc(){
        if(writeMsgToCanvas('canvas',key,$("#pass").val(),0)!=null){ 
        var myCanvas = document.getElementById("canvas");  
        var image = myCanvas.toDataURL("image/png");    
        var element = document.createElement('a');
        element.setAttribute('href', image);
        element.setAttribute('download', 'key.png');
        element.style.display = 'none';
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);        
    }
    }
    loadIMGtoCanvas(img_number,'canvas',writefunc,700);
}

          //execute the rsa key write and dl the iamges
          writeIMG('image_one')
          writeIMG('image_two')

        //after keys have been encoded and set for download,post data
        //TODO: post only if downloaded

        $.ajax({
        type: "POST",
        url: "/signup",
        contentType: 'application/json',
        data: JSON.stringify(post_data),
        dataType: 'json',
        success: function success(data){
          console.log(data.response)
        },

      });


        },

      });
    


    }

    </script>
  </body>
</html>
